#these are the loadings for each of the variables
#create PCoA biplot
p <-
ggplot(aes(X1, X2), data=comb.scores.lake) +
#lake trajectories
geom_path(size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.1,"inches")),
lineend="round") +
#vectors
geom_segment(data = vecs_scaled,
aes(x = 0, y = 0, xend = Dim1, yend = Dim2),
color = "gray40") +
geom_point(data = vecs_scaled,
aes(x = Dim1, y = Dim2, fill = type),
size = 3, pch = 21) +
geom_text_repel(data = vecs_scaled,
aes(x = Dim1, y = Dim2, label = varname),
size =3,
direction="both") +
#general aesthetics
labs(x = paste0("PCoA Axis 1 (",round(var_explained[1]*100,1),"%)"),
y = paste0("PCoA Axis 2 (",round(var_explained[2]*100,1),"%)"),
fill="Variable type") +
ggtitle(lake_plot_titles[i]) +
#normalize axes to allow for comparisons between lakes
scale_x_continuous(limits=c(-1,1))+
scale_y_continuous(limits=c(-1,1))+
scale_fill_manual(values=c("#ffd802","#86a72c")) +
theme_classic(base_size=14)+
theme(legend.position="none")
pcoa.plots.lake[[i]] <- p
}
cowplot::plot_grid(plotlist=pcoa.plots.lake,ncol=2,
label_fontface="plain")
pcoa.variable.vectors.lake <- lapply(pcoa.variable.vectors.lake,tibble::rownames_to_column, var="var")
pcoa.variable.vectors.lake <- do.call(rbind,lapply(pcoa.variable.vectors.lake,as.data.frame))
unique(pcoa.variable.vectors.lake$lake)
write.csv(pcoa.variable.vectors.lake,file="Paleo PCoA/sig_variables_pcoa_by_lake.csv")
for (i in 1:length(lakes)) {
#create df for each lake
lake.master.dat <- subset(master_v3_interp,master_v3_interp$lake==lakes[i])
#standardize diatoms and pigments...
diat.stand.hell.lake <- decostand(lake.master.dat[,4:29], method="hellinger")
pig.stand.hell.lake <- decostand(lake.master.dat[,30:41], method="hellinger")
#...to create distance matrices
diat.dist.lake <- dist(diat.stand.hell.lake, method="euclidean")
pig.dist.lake <- dist(pig.stand.hell.lake, method="euclidean")
#normalize
diat.dist.lake <- diat.dist.lake/max(diat.dist.lake)
pig.dist.lake <- pig.dist.lake/max(pig.dist.lake)
#combine distance matrices...
comb.dist.lake <- diat.dist.lake+pig.dist.lake
#PCoA
comb.mds.lake <- cmdscale(d=comb.dist.lake, k=2, eig=TRUE)
## extract variance explained by PCoA axis 1 and 2
#get eigenvalues
eig_vals <- comb.mds.lake$eig
# Calculate percent variance explained
var_explained <- eig_vals / sum(eig_vals)
#get scores
comb.scores.lake <- data.frame(comb.mds.lake$points)
#add sample IDs
comb.scores.lake$lake <- lake.master.dat$lake
comb.scores.lake$year <- lake.master.dat$year_loess
#save to list
pcoa.scores_lake[[i]] <- comb.scores.lake
#calculate vectors for diatoms and pigments
# Diatoms
diat.vec <- envfit(comb.mds.lake$points, lake.master.dat[,4:29], na.rm = TRUE)
diat.vec.lake <- data.frame(
diat.vec$vectors$arrows,
r2 = diat.vec$vectors$r,
p = diat.vec$vectors$pvals,
varname = colnames(master_v3_interp)[4:29],
type = "diatom"
)
# Pigments
pig.vec <- envfit(comb.mds.lake$points, lake.master.dat[,30:41], na.rm = TRUE)
pig.vec.lake <- data.frame(
pig.vec$vectors$arrows,
r2 = pig.vec$vectors$r,
p = pig.vec$vectors$pvals,
varname = colnames(master_v3_interp)[30:41],
type = "pigment"
)
#keep only significant vectors for plotting
vec.lake <- rbind(diat.vec.lake,pig.vec.lake) %>%
filter(p <= 0.05, r2 >= 0.5) %>%
mutate(lake=lakes[i])
#save these to list
pcoa.variable.vectors.lake[[i]] <- vec.lake
# Scale arrows by r² to indicate correlation strength
vecs_scaled <- vec.lake %>%
mutate(
Dim1 = Dim1 * r2,
Dim2 = Dim2 * r2
)
#these are the loadings for each of the variables
#create PCoA biplot
p <-
ggplot(aes(X1, X2), data=comb.scores.lake) +
#lake trajectories
geom_path(size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.1,"inches")),
lineend="round") +
#vectors
geom_segment(data = vecs_scaled,
aes(x = 0, y = 0, xend = Dim1, yend = Dim2),
color = "gray40") +
geom_point(data = vecs_scaled,
aes(x = Dim1, y = Dim2, fill = type),
size = 3, pch = 21) +
geom_text_repel(data = vecs_scaled,
aes(x = Dim1, y = Dim2, label = varname),
size =3,
direction="both") +
#general aesthetics
labs(x = paste0("PCoA Axis 1 (",round(var_explained[1]*100,1),"%)"),
y = paste0("PCoA Axis 2 (",round(var_explained[2]*100,1),"%)"),
fill="Variable type") +
ggtitle(lake_plot_titles[i]) +
#normalize axes to allow for comparisons between lakes
#scale_x_continuous(limits=c(-1,1))+
#scale_y_continuous(limits=c(-1,1))+
scale_fill_manual(values=c("#ffd802","#86a72c")) +
theme_classic(base_size=14)+
theme(legend.position="none")
pcoa.plots.lake[[i]] <- p
}
cowplot::plot_grid(plotlist=pcoa.plots.lake,ncol=2,
label_fontface="plain")
pcoa.scores_lake <- list() #list to save scores output
pcoa.variable.vectors.lake <- list() #list to save variable vectors
pcoa.plots.lake <- list() #list to save PCoA plots
for (i in 1:length(lakes)) {
#create df for each lake
lake.master.dat <- subset(master_v3_interp,master_v3_interp$lake==lakes[i])
#standardize diatoms and pigments...
diat.stand.hell.lake <- decostand(lake.master.dat[,4:29], method="hellinger")
pig.stand.hell.lake <- decostand(lake.master.dat[,30:41], method="hellinger")
#...to create distance matrices
diat.dist.lake <- dist(diat.stand.hell.lake, method="euclidean")
pig.dist.lake <- dist(pig.stand.hell.lake, method="euclidean")
#normalize
diat.dist.lake <- diat.dist.lake/max(diat.dist.lake)
pig.dist.lake <- pig.dist.lake/max(pig.dist.lake)
#combine distance matrices...
comb.dist.lake <- diat.dist.lake+pig.dist.lake
#PCoA
comb.mds.lake <- cmdscale(d=comb.dist.lake, k=2, eig=TRUE)
## extract variance explained by PCoA axis 1 and 2
#get eigenvalues
eig_vals <- comb.mds.lake$eig
# Calculate percent variance explained
var_explained <- eig_vals / sum(eig_vals)
#get scores
comb.scores.lake <- data.frame(comb.mds.lake$points)
#add sample IDs
comb.scores.lake$lake <- lake.master.dat$lake
comb.scores.lake$year <- lake.master.dat$year_loess
#save to list
pcoa.scores_lake[[i]] <- comb.scores.lake
#calculate vectors for diatoms and pigments
# Diatoms
diat.vec <- envfit(comb.mds.lake$points, lake.master.dat[,4:29], na.rm = TRUE)
diat.vec.lake <- data.frame(
diat.vec$vectors$arrows,
r2 = diat.vec$vectors$r,
p = diat.vec$vectors$pvals,
varname = colnames(master_v3_interp)[4:29],
type = "diatom"
)
# Pigments
pig.vec <- envfit(comb.mds.lake$points, lake.master.dat[,30:41], na.rm = TRUE)
pig.vec.lake <- data.frame(
pig.vec$vectors$arrows,
r2 = pig.vec$vectors$r,
p = pig.vec$vectors$pvals,
varname = colnames(master_v3_interp)[30:41],
type = "pigment"
)
#keep only significant vectors for plotting
vec.lake <- rbind(diat.vec.lake,pig.vec.lake) %>%
filter(p <= 0.05, r2 >= 0.5) %>%
mutate(lake=lakes[i])
#save these to list
pcoa.variable.vectors.lake[[i]] <- vec.lake
# Scale arrows by r² to indicate correlation strength
vecs_scaled <- vec.lake %>%
mutate(
Dim1 = Dim1 * r2,
Dim2 = Dim2 * r2
)
#these are the loadings for each of the variables
#create PCoA biplot
p <-
ggplot(aes(X1, X2), data=comb.scores.lake) +
#lake trajectories
geom_path(size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.1,"inches")),
lineend="round") +
#vectors
geom_segment(data = vecs_scaled,
aes(x = 0, y = 0, xend = Dim1, yend = Dim2),
color = "gray40") +
geom_point(data = vecs_scaled,
aes(x = Dim1, y = Dim2, fill = type),
size = 3, pch = 21) +
geom_text_repel(data = vecs_scaled,
aes(x = Dim1, y = Dim2, label = varname),
size =3,
direction="both") +
#general aesthetics
labs(x = paste0("PCoA Axis 1 (",round(var_explained[1]*100,1),"%)"),
y = paste0("PCoA Axis 2 (",round(var_explained[2]*100,1),"%)"),
fill="Variable type") +
ggtitle(lake_plot_titles[i]) +
#normalize axes to allow for comparisons between lakes
#scale_x_continuous(limits=c(-1,1))+
#scale_y_continuous(limits=c(-1,1))+
scale_fill_manual(values=c("#ffd802","#86a72c")) +
theme_classic(base_size=14)+
theme(legend.position="none")
pcoa.plots.lake[[i]] <- p
}
warnings()
for (i in 1:length(lakes)) {
#create df for each lake
lake.master.dat <- subset(master_v3_interp,master_v3_interp$lake==lakes[i])
#standardize diatoms and pigments...
diat.stand.hell.lake <- decostand(lake.master.dat[,4:29], method="hellinger")
pig.stand.hell.lake <- decostand(lake.master.dat[,30:41], method="hellinger")
#...to create distance matrices
diat.dist.lake <- dist(diat.stand.hell.lake, method="euclidean")
pig.dist.lake <- dist(pig.stand.hell.lake, method="euclidean")
#normalize
diat.dist.lake <- diat.dist.lake/max(diat.dist.lake)
pig.dist.lake <- pig.dist.lake/max(pig.dist.lake)
#combine distance matrices...
comb.dist.lake <- diat.dist.lake+pig.dist.lake
#PCoA
comb.mds.lake <- cmdscale(d=comb.dist.lake, k=2, eig=TRUE)
## extract variance explained by PCoA axis 1 and 2
#get eigenvalues
eig_vals <- comb.mds.lake$eig
# Calculate percent variance explained
var_explained <- eig_vals / sum(eig_vals)
#get scores
comb.scores.lake <- data.frame(comb.mds.lake$points)
#add sample IDs
comb.scores.lake$lake <- lake.master.dat$lake
comb.scores.lake$year <- lake.master.dat$year_loess
#save to list
pcoa.scores_lake[[i]] <- comb.scores.lake
#calculate vectors for diatoms and pigments
# Diatoms
diat.vec <- envfit(comb.mds.lake$points, lake.master.dat[,4:29], na.rm = TRUE)
diat.vec.lake <- data.frame(
diat.vec$vectors$arrows,
r2 = diat.vec$vectors$r,
p = diat.vec$vectors$pvals,
varname = colnames(master_v3_interp)[4:29],
type = "diatom"
)
# Pigments
pig.vec <- envfit(comb.mds.lake$points, lake.master.dat[,30:41], na.rm = TRUE)
pig.vec.lake <- data.frame(
pig.vec$vectors$arrows,
r2 = pig.vec$vectors$r,
p = pig.vec$vectors$pvals,
varname = colnames(master_v3_interp)[30:41],
type = "pigment"
)
#keep only significant vectors for plotting
vec.lake <- rbind(diat.vec.lake,pig.vec.lake) %>%
filter(p <= 0.05, r2 >= 0.5) %>%
mutate(lake=lakes[i])
#save these to list
pcoa.variable.vectors.lake[[i]] <- vec.lake
# Scale arrows by r² to indicate correlation strength
vecs_scaled <- vec.lake %>%
mutate(
Dim1 = Dim1 * r2,
Dim2 = Dim2 * r2
)
#these are the loadings for each of the variables
#create PCoA biplot
p <-
ggplot(aes(X1, X2), data=comb.scores.lake) +
#lake trajectories
geom_path(size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.1,"inches")),
lineend="round") +
#vectors
geom_segment(data = vecs_scaled,
aes(x = 0, y = 0, xend = Dim1, yend = Dim2),
color = "gray40") +
geom_point(data = vecs_scaled,
aes(x = Dim1, y = Dim2, fill = type),
size = 3, pch = 21) +
geom_text_repel(data = vecs_scaled,
aes(x = Dim1, y = Dim2, label = varname),
size =3,
direction="both") +
#general aesthetics
labs(x = paste0("PCoA Axis 1 (",round(var_explained[1]*100,1),"%)"),
y = paste0("PCoA Axis 2 (",round(var_explained[2]*100,1),"%)"),
fill="Variable type") +
ggtitle(lake_plot_titles[i]) +
#normalize axes to allow for comparisons between lakes
scale_x_continuous(limits=c(-1.05,1.05))+
scale_y_continuous(limits=c(-1.05,1.05))+
scale_fill_manual(values=c("#ffd802","#86a72c")) +
theme_classic(base_size=14)+
theme(legend.position="none")
pcoa.plots.lake[[i]] <- p
}
pcoa.scores_lake <- list() #list to save scores output
pcoa.variable.vectors.lake <- list() #list to save variable vectors
pcoa.plots.lake <- list() #list to save PCoA plots
for (i in 1:length(lakes)) {
#create df for each lake
lake.master.dat <- subset(master_v3_interp,master_v3_interp$lake==lakes[i])
#standardize diatoms and pigments...
diat.stand.hell.lake <- decostand(lake.master.dat[,4:29], method="hellinger")
pig.stand.hell.lake <- decostand(lake.master.dat[,30:41], method="hellinger")
#...to create distance matrices
diat.dist.lake <- dist(diat.stand.hell.lake, method="euclidean")
pig.dist.lake <- dist(pig.stand.hell.lake, method="euclidean")
#normalize
diat.dist.lake <- diat.dist.lake/max(diat.dist.lake)
pig.dist.lake <- pig.dist.lake/max(pig.dist.lake)
#combine distance matrices...
comb.dist.lake <- diat.dist.lake+pig.dist.lake
#PCoA
comb.mds.lake <- cmdscale(d=comb.dist.lake, k=2, eig=TRUE)
## extract variance explained by PCoA axis 1 and 2
#get eigenvalues
eig_vals <- comb.mds.lake$eig
# Calculate percent variance explained
var_explained <- eig_vals / sum(eig_vals)
#get scores
comb.scores.lake <- data.frame(comb.mds.lake$points)
#add sample IDs
comb.scores.lake$lake <- lake.master.dat$lake
comb.scores.lake$year <- lake.master.dat$year_loess
#save to list
pcoa.scores_lake[[i]] <- comb.scores.lake
#calculate vectors for diatoms and pigments
# Diatoms
diat.vec <- envfit(comb.mds.lake$points, lake.master.dat[,4:29], na.rm = TRUE)
diat.vec.lake <- data.frame(
diat.vec$vectors$arrows,
r2 = diat.vec$vectors$r,
p = diat.vec$vectors$pvals,
varname = colnames(master_v3_interp)[4:29],
type = "diatom"
)
# Pigments
pig.vec <- envfit(comb.mds.lake$points, lake.master.dat[,30:41], na.rm = TRUE)
pig.vec.lake <- data.frame(
pig.vec$vectors$arrows,
r2 = pig.vec$vectors$r,
p = pig.vec$vectors$pvals,
varname = colnames(master_v3_interp)[30:41],
type = "pigment"
)
#keep only significant vectors for plotting
vec.lake <- rbind(diat.vec.lake,pig.vec.lake) %>%
filter(p <= 0.05, r2 >= 0.5) %>%
mutate(lake=lakes[i])
#save these to list
pcoa.variable.vectors.lake[[i]] <- vec.lake
# Scale arrows by r² to indicate correlation strength
vecs_scaled <- vec.lake %>%
mutate(
Dim1 = Dim1 * r2,
Dim2 = Dim2 * r2
)
#these are the loadings for each of the variables
#create PCoA biplot
p <-
ggplot(aes(X1, X2), data=comb.scores.lake) +
#lake trajectories
geom_path(size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.1,"inches")),
lineend="round") +
#vectors
geom_segment(data = vecs_scaled,
aes(x = 0, y = 0, xend = Dim1, yend = Dim2),
color = "gray40") +
geom_point(data = vecs_scaled,
aes(x = Dim1, y = Dim2, fill = type),
size = 3, pch = 21) +
geom_text_repel(data = vecs_scaled,
aes(x = Dim1, y = Dim2, label = varname),
size =3,
direction="both") +
#general aesthetics
labs(x = paste0("PCoA Axis 1 (",round(var_explained[1]*100,1),"%)"),
y = paste0("PCoA Axis 2 (",round(var_explained[2]*100,1),"%)"),
fill="Variable type") +
ggtitle(lake_plot_titles[i]) +
#normalize axes to allow for comparisons between lakes
scale_x_continuous(limits=c(-1.05,1.05))+
scale_y_continuous(limits=c(-1.05,1.05))+
scale_fill_manual(values=c("#ffd802","#86a72c")) +
theme_classic(base_size=14)+
theme(legend.position="none")
pcoa.plots.lake[[i]] <- p
}
cowplot::plot_grid(plotlist=pcoa.plots.lake,ncol=2,
label_fontface="plain")
## plot up PCoA loadings over time for each lake
pcoa.scores_lake_df <- dplyr::bind_rows(pcoa.scores_lake)
View(pcoa.scores_lake_df)
pcoa.scores_lake <- list() #list to save scores output
pcoa.variable.vectors.lake <- list() #list to save variable vectors
pcoa.plots.lake <- list() #list to save PCoA plots
for (i in 1:length(lakes)) {
#create df for each lake
lake.master.dat <- subset(master_v3_interp,master_v3_interp$lake==lakes[i])
#standardize diatoms and pigments...
diat.stand.hell.lake <- decostand(lake.master.dat[,4:29], method="hellinger")
pig.stand.hell.lake <- decostand(lake.master.dat[,30:41], method="hellinger")
#...to create distance matrices
diat.dist.lake <- dist(diat.stand.hell.lake, method="euclidean")
pig.dist.lake <- dist(pig.stand.hell.lake, method="euclidean")
#normalize
diat.dist.lake <- diat.dist.lake/max(diat.dist.lake)
pig.dist.lake <- pig.dist.lake/max(pig.dist.lake)
#combine distance matrices...
comb.dist.lake <- diat.dist.lake+pig.dist.lake
#PCoA
comb.mds.lake <- cmdscale(d=comb.dist.lake, k=2, eig=TRUE)
## extract variance explained by PCoA axis 1 and 2
#get eigenvalues
eig_vals <- comb.mds.lake$eig
# Calculate percent variance explained
var_explained <- eig_vals / sum(eig_vals)
#get scores
comb.scores.lake <- data.frame(comb.mds.lake$points)
#add sample IDs
comb.scores.lake$lake <- lake.master.dat$lake
comb.scores.lake$year <- lake.master.dat$year_loess
#save to list
pcoa.scores_lake[[i]] <- comb.scores.lake
#calculate vectors for diatoms and pigments
# Diatoms
diat.vec <- envfit(comb.mds.lake$points, lake.master.dat[,4:29], na.rm = TRUE)
diat.vec.lake <- data.frame(
diat.vec$vectors$arrows,
r2 = diat.vec$vectors$r,
p = diat.vec$vectors$pvals,
varname = colnames(master_v3_interp)[4:29],
type = "diatom"
)
# Pigments
pig.vec <- envfit(comb.mds.lake$points, lake.master.dat[,30:41], na.rm = TRUE)
pig.vec.lake <- data.frame(
pig.vec$vectors$arrows,
r2 = pig.vec$vectors$r,
p = pig.vec$vectors$pvals,
varname = colnames(master_v3_interp)[30:41],
type = "pigment"
)
#keep only significant vectors for plotting
vec.lake <- rbind(diat.vec.lake,pig.vec.lake) %>%
filter(p <= 0.05, r2 >= 0.5) %>%
mutate(lake=lakes[i])
#save these to list
pcoa.variable.vectors.lake[[i]] <- vec.lake
# Scale arrows by r² to indicate correlation strength
vecs_scaled <- vec.lake %>%
mutate(
Dim1 = Dim1 * r2,
Dim2 = Dim2 * r2
)
#these are the loadings for each of the variables
#create PCoA biplot
p <-
ggplot(aes(X1, X2), data=comb.scores.lake) +
#lake trajectories
geom_path(size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.1,"inches")),
lineend="round") +
#vectors
geom_segment(data = vecs_scaled,
aes(x = 0, y = 0, xend = Dim1, yend = Dim2),
color = "gray40") +
geom_point(data = vecs_scaled,
aes(x = Dim1, y = Dim2, fill = type),
size = 3, pch = 21) +
geom_text_repel(data = vecs_scaled,
aes(x = Dim1, y = Dim2, label = varname),
size =3,
direction="both") +
#general aesthetics
labs(x = paste0("PCoA Axis 1 (",round(var_explained[1]*100,1),"%)"),
y = paste0("PCoA Axis 2 (",round(var_explained[2]*100,1),"%)"),
fill="Variable type") +
ggtitle(lake_plot_titles[i]) +
#normalize axes to allow for comparisons between lakes
scale_x_continuous(limits=c(-1.3,1.1))+
scale_y_continuous(limits=c(-1.1,1.05))+
scale_fill_manual(values=c("#ffd802","#86a72c")) +
theme_classic(base_size=14)+
theme(legend.position="none")
pcoa.plots.lake[[i]] <- p
}
cowplot::plot_grid(plotlist=pcoa.plots.lake,ncol=2,
label_fontface="plain")
