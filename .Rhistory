aes(x=0,y=0,xend=X1,yend=X2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
ggrepel::geom_label_repel(data=diat.vec.sig.scaled,
aes(x=X1*1.25, y=X2*1.25),label=rownames(diat.vec.sig.scaled),
color="orange", label.size=NA,fill=NA) +
#geochem vectors
# geom_segment(data=geochem.vec.sig.scaled,
#              aes(x=0,y=0,xend=X1,yend=X2),
#              color="hotpink",arrow=arrow(length=unit(0.15, "inches"))) +
# ggrepel::geom_label_repel(data=geochem.vec.sig.scaled,
#           aes(x=X1*1.25, y=X2*1.25),label=rownames(geochem.vec.sig.scaled),
#           color="hotpink", label.size=NA,fill=NA) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
scale_color_manual(values=c("#C1D9B7", #burnt
"#89CFF0", #dunnigan
"#007CAA", #elbow
"#665191", #etwin
"#d45087", #finger
"#7A871E", #flame
"#104210", #smoke
"#E97451" #wtwin
)) +
theme_classic(base_size=14)
?arrow
#plot PCoA paths for all lakes
ggplot(aes(X1, X2),data=site.comb) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="open", ends="first",length=unit(0.1,"inches")),
lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.sig.scaled,
aes(x=0,y=0,xend=X1,yend=X2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
ggrepel::geom_label_repel(data=pig.vec.sig.scaled,
aes(x=X1*1.25, y=X2*1.25),label=rownames(pig.vec.sig.scaled),
color="darkgreen",label.size=NA,fill=NA) +
#diatom vectors
geom_segment(data=diat.vec.sig.scaled,
aes(x=0,y=0,xend=X1,yend=X2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
ggrepel::geom_label_repel(data=diat.vec.sig.scaled,
aes(x=X1*1.25, y=X2*1.25),label=rownames(diat.vec.sig.scaled),
color="orange", label.size=NA,fill=NA) +
#geochem vectors
# geom_segment(data=geochem.vec.sig.scaled,
#              aes(x=0,y=0,xend=X1,yend=X2),
#              color="hotpink",arrow=arrow(length=unit(0.15, "inches"))) +
# ggrepel::geom_label_repel(data=geochem.vec.sig.scaled,
#           aes(x=X1*1.25, y=X2*1.25),label=rownames(geochem.vec.sig.scaled),
#           color="hotpink", label.size=NA,fill=NA) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
scale_color_manual(values=c("#C1D9B7", #burnt
"#89CFF0", #dunnigan
"#007CAA", #elbow
"#665191", #etwin
"#d45087", #finger
"#7A871E", #flame
"#104210", #smoke
"#E97451" #wtwin
)) +
theme_classic(base_size=14)
#plot PCoA paths for all lakes
ggplot(aes(X1, X2),data=site.comb) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.1,"inches")),
lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.sig.scaled,
aes(x=0,y=0,xend=X1,yend=X2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
ggrepel::geom_label_repel(data=pig.vec.sig.scaled,
aes(x=X1*1.25, y=X2*1.25),label=rownames(pig.vec.sig.scaled),
color="darkgreen",label.size=NA,fill=NA) +
#diatom vectors
geom_segment(data=diat.vec.sig.scaled,
aes(x=0,y=0,xend=X1,yend=X2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
ggrepel::geom_label_repel(data=diat.vec.sig.scaled,
aes(x=X1*1.25, y=X2*1.25),label=rownames(diat.vec.sig.scaled),
color="orange", label.size=NA,fill=NA) +
#geochem vectors
# geom_segment(data=geochem.vec.sig.scaled,
#              aes(x=0,y=0,xend=X1,yend=X2),
#              color="hotpink",arrow=arrow(length=unit(0.15, "inches"))) +
# ggrepel::geom_label_repel(data=geochem.vec.sig.scaled,
#           aes(x=X1*1.25, y=X2*1.25),label=rownames(geochem.vec.sig.scaled),
#           color="hotpink", label.size=NA,fill=NA) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
scale_color_manual(values=c("#C1D9B7", #burnt
"#89CFF0", #dunnigan
"#007CAA", #elbow
"#665191", #etwin
"#d45087", #finger
"#7A871E", #flame
"#104210", #smoke
"#E97451" #wtwin
)) +
theme_classic(base_size=14)
#add mix regime to master data
master_v3_interp <- master_v3_interp %>%
mutate(mix.regime = case_when(lake=="burnt"~"Polymictic",
lake=="etwin"~"Polymictic",
lake=="elbow"~"Polymictic",
lake=="smoke"~"Polymictic",
lake=="dunnigan"~"Well mixed",
lake=="finger"~"Well mixed",
lake=="wtwin"~"Dimictic",
lake=="flame"~"Dimictic"))
mixing_regime = unique(master_v3_interp$mix.regime)
colnames(master_v3_interp)
?cmdscale
pcoa.scores_mixing.regime <- list()
View(diat.vec)
pcoa.variable.vectors <- list()
#create df for each mixing regime
mix.master.dat <- subset(master_v3_interp,master_v3_interp$mix.regime==mixing_regime[1])
diat.stand.hell.mix <- decostand(mix.master.dat[,8:33], method="hellinger")
pig.stand.hell.mix <- decostand(poly.master.dat[,34:45], method="hellinger")
diat.stand.hell.mix <- decostand(mix.master.dat[,8:33], method="hellinger")
pig.stand.hell.mix <- decostand(mix.master.dat[,34:45], method="hellinger")
#...to create distance matrices
diat.dist.mix <- dist(diat.stand.hell.mix, method="euclidean")
pig.dist.mix <- dist(pig.stand.hell.mix, method="euclidean")
comb.dist.mix <- diat.dist.mix+pig.dist.mix
#...and scale
comb.mds.mix <- cmdscale(d=comb.dist.mix, k=2)
comb.dist.mix <- diat.dist.mix+pig.dist.mix
#...and scale
comb.mds.mix <- cmdscale(d=comb.dist.mix, k=2)
#get scores
comb.scores.mix <- data.frame(scores(comb.mds.mix))
#add sample IDs
comb.scores.mix$lake <- mix.master.dat$lake
comb.scores.mix$year <- mix.master.dat$year_loess
comb.scores.mix$mix_regime <- mixing_regime[1]
#save to list
pcoa.scores_mixing.regime[[1]] <- comb.dist.mix
View(pcoa.scores_mixing.regime)
#save to list
pcoa.scores_mixing.regime[[1]] <- comb.scores.mix
View(pcoa.scores_mixing.regime)
diat.vec.mix <- envfit(comb.mds.mix,env=mix.master.dat[,8:33],na.rm=T)
diat.vec.mix <- data.frame(cbind(diat.vec.mix$vectors$arrows,
diat.vec.mix$vectors$r,
diat.vec.mix$vectors$pvals,
var_type="diatom"))
#pigments
pig.vec.mix <- envfit(poly.comb.mds,env=poly.master.dat[,34:45],na.rm=T)
pig.vec.mix <- envfit(comb.mds.mix,env=mix.master.dat[,34:45],na.rm=T)
pig.vec.mix <- data.frame(cbind(pig.vec.mix$vectors$arrows,
pig.vec.mix$vectors$r,
pig.vec.mix$vectors$pvals,
var_type="pigment"))
diat.vec.mix <- envfit(comb.mds.mix,env=mix.master.dat[,8:33],na.rm=T)
diat.vec.mix <- data.frame(cbind(diat.vec.mix$vectors$arrows,
diat.vec.mix$vectors$r,
diat.vec.mix$vectors$pvals,
var_type="diatom"))
warnings()
View(diat.vec.mix)
#save these to list
vec.mix <- rbind(diat.vec.mix,pig.vec.mix) %>% mutate(mix_regime=mixing_regime[1])
pcoa.variable.vectors[[i]] <- vec.mix
pcoa.variable.vectors[[1]] <- vec.mix
View(pcoa.variable.vectors)
#keep only significant vectors for plotting
diat.vec.sig <- subset(diat.vec.mix, diat.vec.mix$V4 <= 0.05 & diat.vec.mix$V3 >= 0.6)
pig.vec.mix.sig <- subset(pig.vec.mix, pig.vec.mix$V4 <= 0.05 & pig.vec.mix$V3 >= 0.6)
pcoa.plots <- list()
View(comb.scores.mix)
glimpse(comb.scores.mix)
#create PCoA biplot
#colors
comb.scores.mix <- comb.scores.mix %>% mutate(color = case_when(lake=="burnt" ~ "#C1D9B7",
lake=="dunnigan" ~ "#89CFF0",
lake=="elbow" ~ "#007CAA",
lake=="etwin" ~ "#665191",
lake=="finger" ~"#d45087",
lake=="flame" ~"#7A871E",
lake=="smoke" ~ "#104210",
lake=="wtwin" ~"#E97451")
)
ggplot(aes(Dim1, Dim2),data=comb.scores.mix) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=poly.pig.vec.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=poly.pig.vec.sig.scaled,
aes(x=Dim1, y=Dim2),label=rownames(poly.pig.vec.sig),
color="darkgreen", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=poly.diat.vec.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=poly.diat.vec.sig.scaled,
aes(x=Dim1, y=Dim2),label=rownames(poly.diat.vec.sig),
color="orange", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
ggtitle(mixing_regime[i]) +
scale_color_manual(values=color) +
theme_bw(base_size=14) +
theme(legend.position="bottom")
ggplot(aes(Dim1, Dim2),data=comb.scores.mix) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=pig.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(pig.vec.mix.sig.scaled),
color="darkgreen", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=diat.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(diat.vec.mix.sig.scaled),
color="orange", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
ggtitle(mixing_regime[1]) +
scale_color_manual(values=color) +
theme_bw(base_size=14) +
theme(legend.position="bottom")
diat.vec.mix.sig.scaled <- diat.vec.mix.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
diat.vec.sig <- subset(diat.vec.mix, diat.vec.mix$V4 <= 0.05 & diat.vec.mix$V3 >= 0.6)
pig.vec.mix.sig <- subset(pig.vec.mix, pig.vec.mix$V4 <= 0.05 & pig.vec.mix$V3 >= 0.6)
diat.vec.mix.sig.scaled <- diat.vec.mix.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
#keep only significant vectors for plotting
diat.vec.mix.sig <- subset(diat.vec.mix, diat.vec.mix$V4 <= 0.05 & diat.vec.mix$V3 >= 0.6)
# Scale arrows by r2 to show correlation strength
diat.vec.mix.sig.scaled <- diat.vec.mix.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
#keep only significant vectors for plotting
diat.vec.mix.sig <- subset(diat.vec.mix, diat.vec.mix$V4 <= 0.05 & diat.vec.mix$V3 >= 0.6)
diat.vec.mix.sig
diat.vec.mix.sig.scaled <- diat.vec.mix.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
glimpse(diat.vec.mix.sig)
glimpse(diat.vec.mix)
diat.vec.mix <- data.frame(cbind(diat.vec.mix$vectors$arrows,
diat.vec.mix$vectors$r,
diat.vec.mix$vectors$pvals))
glimpse(diat.vec.mix)
#calculate vectors for diatoms and pigments
#diatom vectors
diat.vec.mix <- envfit(comb.mds.mix,env=mix.master.dat[,8:33],na.rm=T)
diat.vec.mix <- data.frame(cbind(diat.vec.mix$vectors$arrows,
diat.vec.mix$vectors$r,
diat.vec.mix$vectors$pvals))
glimpse(diat.vec.mix)
#calculate vectors for diatoms and pigments
#diatom vectors
diat.vec.mix <- envfit(comb.mds.mix,env=mix.master.dat[,8:33],na.rm=T)
diat.vec.mix <- data.frame(cbind(diat.vec.mix$vectors$arrows,
diat.vec.mix$vectors$r,
diat.vec.mix$vectors$pvals),
var_type="diatoms")
glimpse(diat.vec.mix)
#pigments
pig.vec.mix <- envfit(comb.mds.mix,env=mix.master.dat[,34:45],na.rm=T)
pig.vec.mix <- data.frame(cbind(pig.vec.mix$vectors$arrows,
pig.vec.mix$vectors$r,
pig.vec.mix$vectors$pvals),
var_type="pigment")
#save these to list
vec.mix <- rbind(diat.vec.mix,pig.vec.mix) %>% mutate(mix_regime=mixing_regime[1])
pcoa.variable.vectors[[1]] <- vec.mix
#keep only significant vectors for plotting
diat.vec.mix.sig <- subset(diat.vec.mix, diat.vec.mix$V4 <= 0.05 & diat.vec.mix$V3 >= 0.6)
pig.vec.mix.sig <- subset(pig.vec.mix, pig.vec.mix$V4 <= 0.05 & pig.vec.mix$V3 >= 0.6)
# Scale arrows by r2 to show correlation strength
diat.vec.mix.sig.scaled <- diat.vec.mix.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
pig.vec.mix.sig.scaled <- pig.vec.mix.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
#create PCoA biplot
#colors
comb.scores.mix <- comb.scores.mix %>% mutate(color = case_when(lake=="burnt" ~ "#C1D9B7",
lake=="dunnigan" ~ "#89CFF0",
lake=="elbow" ~ "#007CAA",
lake=="etwin" ~ "#665191",
lake=="finger" ~"#d45087",
lake=="flame" ~"#7A871E",
lake=="smoke" ~ "#104210",
lake=="wtwin" ~"#E97451")
)
ggplot(aes(Dim1, Dim2),data=comb.scores.mix) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=pig.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(pig.vec.mix.sig.scaled),
color="darkgreen", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=diat.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(diat.vec.mix.sig.scaled),
color="orange", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
ggtitle(mixing_regime[1]) +
scale_color_manual(values=color) +
theme_bw(base_size=14) +
theme(legend.position="bottom")
ggplot(aes(Dim1, Dim2),data=comb.scores.mix) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=pig.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(pig.vec.mix.sig.scaled),
color="darkgreen", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=diat.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(diat.vec.mix.sig.scaled),
color="orange", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
ggtitle(mixing_regime[1]) +
scale_color_manual(values=unique(comb.scores.mix$color)) +
theme_bw(base_size=14) +
theme(legend.position="bottom")
p <-
ggplot(aes(Dim1, Dim2),data=comb.scores.mix) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=pig.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(pig.vec.mix.sig.scaled),
color="darkgreen", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=diat.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(diat.vec.mix.sig.scaled),
color="orange", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
ggtitle(mixing_regime[i]) +
scale_color_manual(values=unique(comb.scores.mix$color)) +
theme_bw(base_size=14) +
theme(legend.position="bottom")
p <-
ggplot(aes(Dim1, Dim2),data=comb.scores.mix) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=pig.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(pig.vec.mix.sig.scaled),
color="darkgreen", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=diat.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(diat.vec.mix.sig.scaled),
color="orange", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
ggtitle(mixing_regime[1]) +
scale_color_manual(values=unique(comb.scores.mix$color)) +
theme_bw(base_size=14) +
theme(legend.position="bottom")
pcoa.plots[[1]] <- p
pcoa.plots[[1]]
pcoa.scores_mixing.regime <- list() #list to save scores output
pcoa.variable.vectors <- list() #list to save variable vectors
pcoa.plots <- list()
for (i in 1:length(mixing_regime)) {
#create df for each mixing regime
mix.master.dat <- subset(master_v3_interp,master_v3_interp$mix.regime==mixing_regime[i])
#standardize diatoms and pigments...
diat.stand.hell.mix <- decostand(mix.master.dat[,8:33], method="hellinger")
pig.stand.hell.mix <- decostand(mix.master.dat[,34:45], method="hellinger")
#...to create distance matrices
diat.dist.mix <- dist(diat.stand.hell.mix, method="euclidean")
pig.dist.mix <- dist(pig.stand.hell.mix, method="euclidean")
#combine distance matrices...
comb.dist.mix <- diat.dist.mix+pig.dist.mix
#...and scale
comb.mds.mix <- cmdscale(d=comb.dist.mix, k=2)
#get scores
comb.scores.mix <- data.frame(scores(comb.mds.mix))
#add sample IDs
comb.scores.mix$lake <- mix.master.dat$lake
comb.scores.mix$year <- mix.master.dat$year_loess
comb.scores.mix$mix_regime <- mixing_regime[i]
#save to list
pcoa.scores_mixing.regime[[i]] <- comb.scores.mix
#calculate vectors for diatoms and pigments
#diatom vectors
diat.vec.mix <- envfit(comb.mds.mix,env=mix.master.dat[,8:33],na.rm=T)
diat.vec.mix <- data.frame(cbind(diat.vec.mix$vectors$arrows,
diat.vec.mix$vectors$r,
diat.vec.mix$vectors$pvals),
var_type="diatoms")
#pigments
pig.vec.mix <- envfit(comb.mds.mix,env=mix.master.dat[,34:45],na.rm=T)
pig.vec.mix <- data.frame(cbind(pig.vec.mix$vectors$arrows,
pig.vec.mix$vectors$r,
pig.vec.mix$vectors$pvals),
var_type="pigment")
#save these to list
vec.mix <- rbind(diat.vec.mix,pig.vec.mix) %>% mutate(mix_regime=mixing_regime[1])
pcoa.variable.vectors[[i]] <- vec.mix
#keep only significant vectors for plotting
diat.vec.mix.sig <- subset(diat.vec.mix, diat.vec.mix$V4 <= 0.05 & diat.vec.mix$V3 >= 0.6)
pig.vec.mix.sig <- subset(pig.vec.mix, pig.vec.mix$V4 <= 0.05 & pig.vec.mix$V3 >= 0.6)
# Scale arrows by r2 to show correlation strength
diat.vec.mix.sig.scaled <- diat.vec.mix.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
pig.vec.mix.sig.scaled <- pig.vec.mix.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
#create PCoA biplot
#colors
comb.scores.mix <- comb.scores.mix %>% mutate(color = case_when(lake=="burnt" ~ "#C1D9B7",
lake=="dunnigan" ~ "#89CFF0",
lake=="elbow" ~ "#007CAA",
lake=="etwin" ~ "#665191",
lake=="finger" ~"#d45087",
lake=="flame" ~"#7A871E",
lake=="smoke" ~ "#104210",
lake=="wtwin" ~"#E97451") )
p <-
ggplot(aes(Dim1, Dim2),data=comb.scores.mix) +
#lake trajectories
geom_path(aes(color=lake), size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=pig.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(pig.vec.mix.sig.scaled),
color="darkgreen", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.mix.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange",arrow=arrow(length=unit(0.15, "inches"))) +
geom_text(data=diat.vec.mix.sig.scaled,
aes(x=Dim1*1.2, y=Dim2*1.2),label=rownames(diat.vec.mix.sig.scaled),
color="orange", size=4,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
labs(x = "PCoA Axis 1", y = "PCoA Axis 2", color = "Lake") +
ggtitle(mixing_regime[i]) +
scale_color_manual(values=unique(comb.scores.mix$color)) +
theme_bw(base_size=14) +
theme(legend.position="bottom")
pcoa.plots[[i]] <- p
}
View(pcoa.plots)
cowplot::plot_grid(pcoa.plots[1],pcoa.plots[2],pcoa.plots[3])
cowplot::plot_grid(pcoa.plots[[1]],pcoa.plots[[2]],pcoa.plots[[3]])
cowplot::plot_grid(pcoa.plots[[1]],pcoa.plots[[2]],pcoa.plots[[3]],ncol=3)
cowplot::plot_grid(pcoa.plots[[2]],pcoa.plots[[1]],pcoa.plots[[3]],ncol=3)
