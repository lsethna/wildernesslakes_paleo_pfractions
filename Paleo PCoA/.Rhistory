aes(x=Dim1, y=Dim2),label=rownames(diat.vec.lake.sig.scaled),
color="orange", size=3,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
ggtitle(lake_plot_titles[i]) +
theme_classic()+
theme(axis.title=element_blank(),
title=element_text(size=11),
axis.text=element_text(size=10))
pcoa.plots[[i]] <- p
}
for (i in 1:length(lakes)) {
#create df for each mixing regime
lake.master.dat <- subset(master_v3_interp,master_v3_interp$lake==lakes[i])
#standardize diatoms and pigments...
diat.stand.hell.lake <- decostand(lake.master.dat[,4:29], method="hellinger")
pig.stand.hell.lake <- decostand(lake.master.dat[,30:41], method="hellinger")
#...to create distance matrices
diat.dist.lake <- dist(diat.stand.hell.lake, method="euclidean")
pig.dist.lake <- dist(pig.stand.hell.lake, method="euclidean")
#combine distance matrices...
comb.dist.lake <- diat.dist.lake+pig.dist.lake
#...and scale
comb.mds.lake <- cmdscale(d=comb.dist.lake, k=2)
#get scores
comb.scores.lake <- data.frame(scores(comb.mds.lake))
#add sample IDs
comb.scores.lake$lake <- lake.master.dat$lake
comb.scores.lake$year <- lake.master.dat$year_loess
#save to list
pcoa.scores_lake[[i]] <- comb.scores.lake
#calculate vectors for diatoms and pigments
#diatom vectors
diat.vec.lake <- envfit(comb.mds.lake,env=lake.master.dat[,4:29],na.rm=T)
diat.vec.lake <- data.frame(cbind(diat.vec.lake$vectors$arrows,
diat.vec.lake$vectors$r,
diat.vec.lake$vectors$pvals),
var_type="diatoms")
#pigments
pig.vec.lake <- envfit(comb.mds.lake,env=lake.master.dat[,30:41],na.rm=T)
pig.vec.lake <- data.frame(cbind(pig.vec.lake$vectors$arrows,
pig.vec.lake$vectors$r,
pig.vec.lake$vectors$pvals),
var_type="pigment")
#keep only significant vectors for plotting
diat.vec.lake.sig <- subset(diat.vec.lake, diat.vec.lake$V4 <= 0.05 & diat.vec.lake$V3 >= 0.5)
pig.vec.lake.sig <- subset(pig.vec.lake, pig.vec.lake$V4 <= 0.05 & pig.vec.lake$V3 >= 0.5)
#save these to list
vec.lake <- rbind(diat.vec.lake.sig,pig.vec.lake.sig) %>% mutate(lake=lakes[i])
pcoa.variable.vectors.lake[[i]] <- vec.lake
# Scale arrows by r2 to show correlation strength
diat.vec.lake.sig.scaled <- diat.vec.lake.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
pig.vec.lake.sig.scaled <- pig.vec.lake.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
#create PCoA biplot
#colors
comb.scores.lake <- comb.scores.lake %>%
mutate(color = case_when(
lake == "flame"    ~ "#9b3d3d",
lake == "burnt"    ~ "#d77932",
lake == "smoke"    ~ "#e3b448",
lake == "elbow"    ~ "#9a77b5",
lake == "finger"   ~ "#62497a",
lake == "etwin"    ~ "#6d91c1",
lake == "wtwin"    ~ "#3b5b7c",
lake == "dunnigan" ~ "#8b5a2b"
))
p <-
ggplot(aes(Dim1, Dim2),data=comb.scores.lake) +
#lake trajectories
geom_path(color="black", size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.lake.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen") +
geom_text(data=pig.vec.lake.sig.scaled,
aes(x=Dim1, y=Dim2),label=rownames(pig.vec.lake.sig.scaled),
color="darkgreen", size=3,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.lake.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange") +
geom_text(data=diat.vec.lake.sig.scaled,
aes(x=Dim1, y=Dim2),label=rownames(diat.vec.lake.sig.scaled),
color="orange", size=3,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
ggtitle(lake_plot_titles[i]) +
theme_classic()+
theme(axis.title=element_blank(),
title=element_text(size=11),
axis.text=element_text(size=10))
pcoa.plots[[i]] <- p
}
for (i in 1:length(lakes)) {
#create df for each mixing regime
lake.master.dat <- subset(master_v3_interp,master_v3_interp$lake==lakes[i])
#standardize diatoms and pigments...
diat.stand.hell.lake <- decostand(lake.master.dat[,4:29], method="hellinger")
pig.stand.hell.lake <- decostand(lake.master.dat[,30:41], method="hellinger")
#...to create distance matrices
diat.dist.lake <- dist(diat.stand.hell.lake, method="euclidean")
pig.dist.lake <- dist(pig.stand.hell.lake, method="euclidean")
#combine distance matrices...
comb.dist.lake <- diat.dist.lake+pig.dist.lake
#...and scale
comb.mds.lake <- cmdscale(d=comb.dist.lake, k=2)
#get scores
comb.scores.lake <- data.frame(scores(comb.mds.lake))
#add sample IDs
comb.scores.lake$lake <- lake.master.dat$lake
comb.scores.lake$year <- lake.master.dat$year_loess
#save to list
pcoa.scores_lake[[i]] <- comb.scores.lake
#calculate vectors for diatoms and pigments
#diatom vectors
diat.vec.lake <- envfit(comb.mds.lake,env=lake.master.dat[,4:29],na.rm=T)
diat.vec.lake <- data.frame(cbind(diat.vec.lake$vectors$arrows,
diat.vec.lake$vectors$r,
diat.vec.lake$vectors$pvals),
var_type="diatoms")
#pigments
pig.vec.lake <- envfit(comb.mds.lake,env=lake.master.dat[,30:41],na.rm=T)
pig.vec.lake <- data.frame(cbind(pig.vec.lake$vectors$arrows,
pig.vec.lake$vectors$r,
pig.vec.lake$vectors$pvals),
var_type="pigment")
#keep only significant vectors for plotting
diat.vec.lake.sig <- subset(diat.vec.lake, diat.vec.lake$V4 <= 0.05 & diat.vec.lake$V3 >= 0.5)
pig.vec.lake.sig <- subset(pig.vec.lake, pig.vec.lake$V4 <= 0.05 & pig.vec.lake$V3 >= 0.5)
#save these to list
vec.lake <- rbind(diat.vec.lake.sig,pig.vec.lake.sig) %>% mutate(lake=lakes[i])
pcoa.variable.vectors.lake[[i]] <- vec.lake
# Scale arrows by r2 to show correlation strength
diat.vec.lake.sig.scaled <- diat.vec.lake.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
pig.vec.lake.sig.scaled <- pig.vec.lake.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
#create PCoA biplot
#colors
comb.scores.lake <- comb.scores.lake %>%
mutate(color = case_when(
lake == "flame"    ~ "#9b3d3d",
lake == "burnt"    ~ "#d77932",
lake == "smoke"    ~ "#e3b448",
lake == "elbow"    ~ "#9a77b5",
lake == "finger"   ~ "#62497a",
lake == "etwin"    ~ "#6d91c1",
lake == "wtwin"    ~ "#3b5b7c",
lake == "dunnigan" ~ "#8b5a2b"
))
p <-
ggplot(aes(Dim1, Dim2),data=comb.scores.lake) +
#lake trajectories
geom_path(color="black", size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.lake.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen") +
geom_text(data=pig.vec.lake.sig.scaled,
aes(x=Dim1, y=Dim2),label=rownames(pig.vec.lake.sig.scaled),
color="darkgreen", size=3,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.lake.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange") +
geom_text(data=diat.vec.lake.sig.scaled,
aes(x=Dim1, y=Dim2),label=rownames(diat.vec.lake.sig.scaled),
color="orange", size=3,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
ggtitle(lake_plot_titles[i]) +
theme_classic()+
theme(axis.title=element_blank(),
title=element_text(size=11),
axis.text=element_text(size=10))
pcoa.plots.lake[[i]] <- p
}
cowplot::plot_grid(plotlist=pcoa.plots,ncol=2,
labels=c("(a)","(b)","(c)","(d)","(e)","(f)","(g)","(h)"),
label_fontface="plain")
cowplot::plot_grid(plotlist=pcoa.plots.lake,ncol=2,
labels=c("(a)","(b)","(c)","(d)","(e)","(f)","(g)","(h)"),
label_fontface="plain")
pcoa.variable.vectors.lake <- lapply(pcoa.variable.vectors.lake,tibble::rownames_to_column, var="var")
pcoa.sig.variables.lake <- do.call(rbind,lapply(pcoa.variable.vectors.lake,as.data.frame))
## plot up PCoA loadings over time for each lake
pcoa.scores_lake_df <- dplyr::bind_rows(pcoa.scores_lake)
glimpse(pcoa.scores_lake_df)
?round
round(2018.906)
pcoa.scores_lake_df %>%
mutate(year_round = round(year)) %>%
group_by(lake,year_round) %>%
summarize(Dim1 = median(Dim1)) %>%
ggplot(aes(x=year_round,y=Dim1,color=lake))+
geom_vline(xintercept = 1900,lty="dashed")+
geom_vline(xintercept = 1970,lty="dashed")+
#geom_point()+
geom_smooth(se=F)+
#geom_line(size=1)+
theme_classic()
pcoa.scores_lake_df %>%
mutate(year_round = round(year)) %>%
group_by(lake, year_round) %>%
summarize(Dim1 = median(Dim1), .groups = "drop") %>%
ggplot(aes(x = year_round, y = Dim1, color = lake)) +
geom_vline(xintercept = 1900, lty = "dashed") +
geom_vline(xintercept = 1970, lty = "dashed") +
geom_smooth(se = FALSE, size = 1.2) +
theme_classic(base_size = 14) +
scale_color_manual(
values = c(
"burnt"    = "#d77932",
"dunnigan" = "#8b5a2b",
"elbow"    = "#9a77b5",
"etwin"    = "#6d91c1",
"finger"   = "#62497a",
"flame"    = "#9b3d3d",
"smoke"    = "#e3b448",
"wtwin"    = "#3b5b7c"
)
) +
labs(
x = "Year",
y = "PCoA Axis 1 (25.7%)",
color = "Lake"
)
View(lake.master.dat)
View(master_v3_interp)
## ------------------------------- ##
## ---- interpolate variables ---- ##
## ------------------------------- ##
master_v3_interp <- master_v2 %>%
#remove rows where all bio vars are NA
filter(!if_all(ast_formosa:b_car,is.na)) %>%
group_by(lake) %>%
#will replace NA values with interpolated values - done at every dated interval
mutate_at(vars(ast_formosa:b_car),funs(zoo::na.approx(.,method="constant",rule=2))) %>% #rule=2 means extend nearest values to leading/trailing NAs
ungroup() %>%
drop_na() #remove any NA values - beyond dated intervals
librarian::shelf(tidyverse,grid,vegan,cowplot,zoo)
View(master_v2)
View(master_v2)
#filter master data based on selected diatoms and pigments
master_v2 <- master_dat %>% select(lake,year_loess,depth, #id info
## not using geochem vars for PCoA
#9:11, #loi; perc inorg,org,calc
#16:23, #P and P fractions
#14, #BSi flux
sel_diat$name,# select diatoms
sel_pig$name, #select pigments
#274:276 #TOC, TN, TOC:TN
)
## ------------------------------- ##
## ---- interpolate variables ---- ##
## ------------------------------- ##
master_v3_interp <- master_v2 %>%
#remove rows where all bio vars are NA
filter(!if_all(ast_formosa:b_car,is.na)) %>%
group_by(lake) %>%
#will replace NA values with interpolated values - done at every dated interval
mutate_at(vars(ast_formosa:b_car),funs(zoo::na.approx(.,method="constant",rule=2))) %>% #rule=2 means extend nearest values to leading/trailing NAs
ungroup() %>%
drop_na() #remove any NA values - beyond dated intervals
View(master_v3_interp)
#put in order for plotting
lakes = c("dunnigan","finger","burnt","smoke","elbow","etwin","flame","wtwin")
#make list of plot titles
lake_plot_titles <- c("Dunnigan","Finger","Burnt","Smoke","Elbow","East Twin","Flame","West Twin")
pcoa.scores_lake <- list() #list to save scores output
pcoa.variable.vectors.lake <- list() #list to save variable vectors
pcoa.plots.lake <- list() #list to save PCoA plots
for (i in 1:length(lakes)) {
#create df for each mixing regime
lake.master.dat <- subset(master_v3_interp,master_v3_interp$lake==lakes[i])
#standardize diatoms and pigments...
diat.stand.hell.lake <- decostand(lake.master.dat[,4:29], method="hellinger")
pig.stand.hell.lake <- decostand(lake.master.dat[,30:41], method="hellinger")
#...to create distance matrices
diat.dist.lake <- dist(diat.stand.hell.lake, method="euclidean")
pig.dist.lake <- dist(pig.stand.hell.lake, method="euclidean")
#combine distance matrices...
comb.dist.lake <- diat.dist.lake+pig.dist.lake
#...and scale
comb.mds.lake <- cmdscale(d=comb.dist.lake, k=2)
#get scores
comb.scores.lake <- data.frame(scores(comb.mds.lake))
#add sample IDs
comb.scores.lake$lake <- lake.master.dat$lake
comb.scores.lake$year <- lake.master.dat$year_loess
#save to list
pcoa.scores_lake[[i]] <- comb.scores.lake
#calculate vectors for diatoms and pigments
#diatom vectors
diat.vec.lake <- envfit(comb.mds.lake,env=lake.master.dat[,4:29],na.rm=T)
diat.vec.lake <- data.frame(cbind(diat.vec.lake$vectors$arrows,
diat.vec.lake$vectors$r,
diat.vec.lake$vectors$pvals),
var_type="diatoms")
#pigments
pig.vec.lake <- envfit(comb.mds.lake,env=lake.master.dat[,30:41],na.rm=T)
pig.vec.lake <- data.frame(cbind(pig.vec.lake$vectors$arrows,
pig.vec.lake$vectors$r,
pig.vec.lake$vectors$pvals),
var_type="pigment")
#keep only significant vectors for plotting
diat.vec.lake.sig <- subset(diat.vec.lake, diat.vec.lake$V4 <= 0.05 & diat.vec.lake$V3 >= 0.5)
pig.vec.lake.sig <- subset(pig.vec.lake, pig.vec.lake$V4 <= 0.05 & pig.vec.lake$V3 >= 0.5)
#save these to list
vec.lake <- rbind(diat.vec.lake.sig,pig.vec.lake.sig) %>% mutate(lake=lakes[i])
pcoa.variable.vectors.lake[[i]] <- vec.lake
# Scale arrows by r2 to show correlation strength
diat.vec.lake.sig.scaled <- diat.vec.lake.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
pig.vec.lake.sig.scaled <- pig.vec.lake.sig %>%
mutate(Dim1 = (Dim1*V3)/2,
Dim2 = (Dim2*V3)/2)
#create PCoA biplot
#colors
comb.scores.lake <- comb.scores.lake %>%
mutate(color = case_when(
lake == "flame"    ~ "#9b3d3d",
lake == "burnt"    ~ "#d77932",
lake == "smoke"    ~ "#e3b448",
lake == "elbow"    ~ "#9a77b5",
lake == "finger"   ~ "#62497a",
lake == "etwin"    ~ "#6d91c1",
lake == "wtwin"    ~ "#3b5b7c",
lake == "dunnigan" ~ "#8b5a2b"
))
p <-
ggplot(aes(Dim1, Dim2),data=comb.scores.lake) +
#lake trajectories
geom_path(color="black", size=0.75,
arrow=arrow(type="closed", ends="first",length=unit(0.05,"inches")), lineend="round") +
#pigment vectors
geom_segment(data=pig.vec.lake.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="darkgreen") +
geom_text(data=pig.vec.lake.sig.scaled,
aes(x=Dim1, y=Dim2),label=rownames(pig.vec.lake.sig.scaled),
color="darkgreen", size=3,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#diatom vectors
geom_segment(data=diat.vec.lake.sig.scaled,
aes(x=0,y=0,xend=Dim1,yend=Dim2),
color="orange") +
geom_text(data=diat.vec.lake.sig.scaled,
aes(x=Dim1, y=Dim2),label=rownames(diat.vec.lake.sig.scaled),
color="orange", size=3,vjust=-0.5,
position=position_jitter(width=0.1,height=0.1)) +
#general aesthetics
ggtitle(lake_plot_titles[i]) +
theme_classic()+
theme(axis.title=element_blank(),
title=element_text(size=11),
axis.text=element_text(size=10))
pcoa.plots.lake[[i]] <- p
}
View(lake.master.dat)
pcoa.variable.vectors.lake <- lapply(pcoa.variable.vectors.lake,tibble::rownames_to_column, var="var")
pcoa.sig.variables.lake <- do.call(rbind,lapply(pcoa.variable.vectors.lake,as.data.frame))
## plot up PCoA loadings over time for each lake
pcoa.scores_lake_df <- dplyr::bind_rows(pcoa.scores_lake)
glimpse(pcoa.scores_lake_df)
pcoa.scores_lake_df %>%
mutate(year_round = round(year)) %>%
group_by(lake, year_round) %>%
summarize(Dim1 = median(Dim1), .groups = "drop") %>%
ggplot(aes(x = year_round, y = Dim1, color = lake)) +
geom_vline(xintercept = 1900, lty = "dashed") +
geom_vline(xintercept = 1970, lty = "dashed") +
geom_smooth(se = FALSE, size = 1.2) +
theme_classic(base_size = 14) +
scale_color_manual(
values = c(
"burnt"    = "#d77932",
"dunnigan" = "#8b5a2b",
"elbow"    = "#9a77b5",
"etwin"    = "#6d91c1",
"finger"   = "#62497a",
"flame"    = "#9b3d3d",
"smoke"    = "#e3b448",
"wtwin"    = "#3b5b7c"
)
) +
labs(
x = "Year",
y = "PCoA Axis 1 (25.7%)",
color = "Lake"
)
View(master_v3_interp)
View(master_v2)
View(master_dat)
rm(list=ls())
setwd("C:/Users/lsethna_smm/Documents/GitHub/wildernesslakes_paleo_pfractions/Paleo PCoA")
pcoa_loadings <- read.csv("WLPCoAScores.csv")
glimpse(pcoa_loadings)
librarian::shelf(tidyverse)
pcoa_loadings <- read.csv("WLPCoAScores.csv")
glimpse(pcoa_loadings)
ggplot(pcoa_loadings, aes(x=year,y=Dim1,color=lake))+
geom_line()
ggplot(pcoa_loadings, aes(x=year,y=Dim1,color=lake))+
geom_line() +
scale_color_manual(values=c("#d77932", #burnt
"#8b5a2b", #dunnigan
"#9a77b5", #elbow
"#6d91c1", #etwin
"#62497a", #finger
"#9b3d3d", #flame
"#e3b448", #smoke
"#3b5b7c" #wtwin
))
ggplot(pcoa_loadings, aes(x=year,y=Dim1,color=lake))+
geom_line(size=2) +
scale_color_manual(values=c("#d77932", #burnt
"#8b5a2b", #dunnigan
"#9a77b5", #elbow
"#6d91c1", #etwin
"#62497a", #finger
"#9b3d3d", #flame
"#e3b448", #smoke
"#3b5b7c" #wtwin
)) +
theme_classic()
ggplot(pcoa_loadings, aes(x=year,y=Dim1,color=lake))+
geom_line(linewidth=1) +
scale_color_manual(values=c("#d77932", #burnt
"#8b5a2b", #dunnigan
"#9a77b5", #elbow
"#6d91c1", #etwin
"#62497a", #finger
"#9b3d3d", #flame
"#e3b448", #smoke
"#3b5b7c" #wtwin
)) +
theme_classic()
View(pcoa_loadings)
View(pcoa_loadings)
librarian::shelf(tidyverse,grid,vegan,cowplot,zoo)
rm(list=ls())
setwd("C:/Users/lsethna_smm/Documents/GitHub/wildernesslakes_paleo_pfractions/Paleo PCoA")
#read in master data
master_dat <- read.csv("C:/Users/lsethna_smm/Documents/GitHub/wildernesslakes_paleo_pfractions/raw_data/WL_paleo_masterdataset_20Nov2024.csv") %>%
select(!X)
## ------------------------------------------------------------ ##
## ---- filter variables: pigments>0, diatoms>2% abundance ---- ##
## ------------------------------------------------------------ ##
vars <- data.frame(
column_n=1:length(master_dat),
vars=colnames(master_dat))
#pigments 25:56
#diatoms 57:270
sel_diat <- master_dat %>% select(colnames(master_dat[,c(56:269)])) %>%
pivot_longer(cols=ach_microcephala:uln_ulna) %>% filter(value>5) %>% #filter to 5% relative abundance (might want to only filter to 2% and at least in two samples)
select(name) %>% distinct()
##
sel_p <- master_dat %>% select(colnames(master_dat[,24:55])) %>%
summarize(across(chlide_a:car_z,max,na.rm=T))
sel_pig <- sel_p %>%
select(!c("sudan","chl_c1","chl_c2","fuco","diadino","chl_b","chl_a","chl_ap")) %>% #remove unstable or non-interpretable pigments
pivot_longer(cols=chlide_a:car_z) %>% filter(value>0) #remove any non-detect pigments
#filter master data based on selected diatoms and pigments
master_v2 <- master_dat %>% select(lake,year_loess,depth, #id info
#9:11, #loi; perc inorg,org,calc
#16:23, #P and P fractions
14,sel_diat$name, #BSi flux, select diatoms
sel_pig$name, #select pigments
#274:276 #TOC, TN, TOC:TN
)
glimpse(master_v2)
## ------------------------------- ##
## ---- interpolate variables ---- ##
## ------------------------------- ##
master_v3_interp <- master_v2 %>%
group_by(lake) %>%
#will replace NA values with interpolated values - done at every dated interval
mutate_at(vars(percent_organic:b_car),funs(zoo::na.approx(.,method="constant",rule=2))) %>% #rule=2 means extend nearest values to leading/trailing NAs
ungroup() %>%
drop_na() #remove any NA values - beyond dated intervals
View(master_v2)
#filter master data based on selected diatoms and pigments
master_v2 <- master_dat %>% select(lake,year_loess,depth, #id info
#9:11, #loi; perc inorg,org,calc
#16:23, #P and P fractions
#14, #BSi flux
sel_diat$name, #select diatoms
sel_pig$name, #select pigments
#274:276 #TOC, TN, TOC:TN
)
glimpse(master_v2)
## ------------------------------- ##
## ---- interpolate variables ---- ##
## ------------------------------- ##
master_v3_interp <- master_v2 %>%
group_by(lake) %>%
#will replace NA values with interpolated values - done at every dated interval
mutate_at(vars(ast_formosa:b_car),funs(zoo::na.approx(.,method="constant",rule=2))) %>% #rule=2 means extend nearest values to leading/trailing NAs
ungroup() %>%
drop_na() #remove any NA values - beyond dated intervals
